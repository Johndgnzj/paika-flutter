# Paika v3.2.0 — 統計與體驗優化 開發清單

> **前置版本：** v3.1.0（已完成：主色調更換、Logo、使用條款、使用手冊）

---

## 一、玩家統計增強

- [ ] **最高單局記錄高亮顯示**
  - [ ] 在玩家統計頁標示歷史最高「單一局」得分（例如某場東風東局贏了 500 元）
  - [ ] 顯示該局的資訊（場次名稱、日期、台數、金額）
  - [ ] 高亮顯示，可點擊跳轉到該場牌局詳情

- [ ] **統計數據時間範圍篩選**
  - [ ] 篩選選項：近一週 / 近一月 / 全部
  - [ ] 篩選後重新計算勝率、平均得分等統計數據
  - [ ] UI：SegmentedButton 或 DropdownButton

- [ ] **牌局稱號標示**
  - [ ] 每場牌局的「最終排名」頁面，在玩家名稱後顯示稱號徽章
  - [ ] 胡牌王 🏆：該場胡牌次數最多的玩家
  - [ ] 自摸王 🎯：該場自摸次數最多的玩家
  - [ ] 放槍王 💥：該場放槍次數最多的玩家
  - [ ] 次數為 0 的稱號不顯示
  - [ ] 若有同分則皆顯示

---

## 二、分享功能

- [ ] **牌局結果截圖分享**
  - [ ] 分享內容：「最終排名」和「數據統計」兩頁的截圖
  - [ ] 所有平台統一使用截圖方式（Web 下載圖片、手機分享圖片）
  - [ ] 截圖包含：牌局名稱、日期、玩家排名與分數
  - [ ] 在牌局詳情頁加入分享按鈕觸發

---

## 三、語音記分

- [ ] **語音記分功能**
  - [ ] 在即時計分畫面（game_play_screen）加入麥克風按鈕（中央功能區或角落）
  - [ ] 支援語音指令格式：
    - 胡牌：「{贏家}胡{輸家}{N}台」— 例如「小明胡阿華5台」「東家胡南家3台」
    - 自摸：「{贏家}自摸{N}台」— 例如「莊家自摸4台」「西家自摸8台」
  - [ ] 玩家識別方式（皆支援）：
    - 玩家名稱：「小明」「阿華」（模糊匹配，容許語音辨識的些微差異）
    - 風位：「東家」「南家」「西家」「北家」
    - 莊家：「莊家」（自動對應當前莊家）
  - [ ] 語音辨識後的流程：
    1. 按住麥克風說話（或點擊開始/停止）
    2. 語音轉文字
    3. 解析文字 → 提取：贏家、動作類型（胡/自摸）、輸家（胡牌時）、台數
    4. 帶入解析結果，開啟 QuickScoreDialog 預填內容
    5. 使用者可手動調整或直接確認
  - [ ] 解析失敗處理：
    - 無法辨識語音 → 顯示「無法辨識，請再試一次」提示
    - 語音辨識成功但無法解析內容 → 顯示辨識文字，提示格式範例
    - 部分解析成功（例如只辨識出動作和台數）→ 帶入已知部分，其餘讓使用者手動選
  - [ ] 平台技術方案：
    - Web：Web Speech API（`webkitSpeechRecognition`）
    - 手機：`speech_to_text` 套件
    - 語言：zh-TW（繁體中文）
  - [ ] 台數辨識支援：
    - 中文數字：「三台」→ 3、「十二台」→ 12
    - 阿拉伯數字：「5台」→ 5
    - 省略「台」字：「小明胡阿華5」→ 也能辨識

---

## 檔案影響預估

| 功能 | 可能影響的檔案 |
|------|--------------|
| 最高單局記錄 | `player_stats_screen.dart`, `stats_service.dart` |
| 時間範圍篩選 | `player_stats_screen.dart`, `stats_service.dart` |
| 牌局稱號標示 | `game_detail_screen.dart` |
| 截圖分享 | `game_detail_screen.dart`, 新增截圖邏輯（`screenshot` 或 `RepaintBoundary`） |
| 語音記分 | `game_play_screen.dart`（麥克風按鈕）, 新增 `voice_scoring_service.dart`（語音解析邏輯）, `quick_score_dialog.dart`（支援預填參數）, `pubspec.yaml`（新增 `speech_to_text` 套件） |

---

*最後更新：2026-02-17*
